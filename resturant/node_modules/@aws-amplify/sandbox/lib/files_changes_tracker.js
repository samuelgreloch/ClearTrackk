import { glob } from 'glob';
/**
 * This class accumulates information about files that have changed.
 */
export class FilesChangesTracker {
    snapshot;
    /**
     * Creates a new file changes tracker.
     */
    constructor(snapshot) {
        this.snapshot = snapshot;
    }
    trackFileChange = (path) => {
        this.snapshot.didAnyFileChangeSinceStart = true;
        if (path.endsWith('.ts') || path.endsWith('.tsx')) {
            this.snapshot.didAnyTypeScriptFileChangeSinceLastSnapshot = true;
        }
    };
    getAndResetSnapshot = () => {
        // shallow copy is ok for 1 dim data structure
        const currentSnapshot = { ...this.snapshot };
        this.resetSnapshot();
        return currentSnapshot;
    };
    resetSnapshot = () => {
        this.snapshot.didAnyTypeScriptFileChangeSinceLastSnapshot = false;
    };
}
/**
 * Creates a new instance of files changes tracker.
 */
export const createFilesChangesTracker = async (rootPath) => {
    const tsFiles = await glob('**/*.{ts,tsx}', {
        ignore: 'node_modules/**',
        cwd: rootPath,
    });
    return new FilesChangesTracker({
        didAnyFileChangeSinceStart: false,
        hadTypeScriptFilesAtStart: tsFiles.length > 0,
        didAnyTypeScriptFileChangeSinceLastSnapshot: false,
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZXNfY2hhbmdlc190cmFja2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2ZpbGVzX2NoYW5nZXNfdHJhY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBUTVCOztHQUVHO0FBQ0gsTUFBTSxPQUFPLG1CQUFtQjtJQUlEO0lBSDdCOztPQUVHO0lBQ0gsWUFBNkIsUUFBcUM7UUFBckMsYUFBUSxHQUFSLFFBQVEsQ0FBNkI7SUFBRyxDQUFDO0lBRXRFLGVBQWUsR0FBRyxDQUFDLElBQVksRUFBRSxFQUFFO1FBQ2pDLElBQUksQ0FBQyxRQUFRLENBQUMsMEJBQTBCLEdBQUcsSUFBSSxDQUFDO1FBQ2hELElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1lBQ2pELElBQUksQ0FBQyxRQUFRLENBQUMsMkNBQTJDLEdBQUcsSUFBSSxDQUFDO1NBQ2xFO0lBQ0gsQ0FBQyxDQUFDO0lBRUYsbUJBQW1CLEdB