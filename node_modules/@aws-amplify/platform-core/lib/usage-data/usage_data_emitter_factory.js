"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UsageDataEmitterFactory = void 0;
const local_configuration_controller_factory_js_1 = require("../config/local_configuration_controller_factory.js");
const noop_usage_data_emitter_js_1 = require("./noop_usage_data_emitter.js");
const usage_data_emitter_js_1 = require("./usage_data_emitter.js");
const constants_js_1 = require("./constants.js");
/**
 * Creates UsageDataEmitter for a given library version
 */
class UsageDataEmitterFactory {
    /**
     * Creates UsageDataEmitter for a given library version, usage data tracking preferences
     */
    getInstance = async (libraryVersion, dependencies) => {
        const configController = local_configuration_controller_factory_js_1.configControllerFactory.getInstance('usage_data_preferences.json');
        const usageDataTrackingDisabledLocalFile = (await configController.get(constants_js_1.USAGE_DATA_TRACKING_ENABLED)) ===
            false;
        if (process.env.AMPLIFY_DISABLE_TELEMETRY ||
            usageDataTrackingDisabledLocalFile) {
            return new noop_usage_data_emitter_js_1.NoOpUsageDataEmitter();
        }
        return new usage_data_emitter_js_1.DefaultUsageDataEmitter(libraryVersion, dependencies);
    };
}
exports.UsageDataEmitterFactory = UsageDataEmitterFactory;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNhZ2VfZGF0YV9lbWl0dGVyX2ZhY3RvcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvdXNhZ2UtZGF0YS91c2FnZV9kYXRhX2VtaXR0ZXJfZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtSEFBOEY7QUFDOUYsNkVBQW9FO0FBQ3BFLG1FQUFrRTtBQUNsRSxpREFBNkQ7QUFlN0Q7O0dBRUc7QUFDSCxNQUFhLHVCQUF1QjtJQUNsQzs7T0FFRztJQUNILFdBQVcsR0FBRyxLQUFLLEVBQ2pCLGNBQXNCLEVBQ3RCLFlBQWdDLEVBQ0wsRUFBRTtRQUM3QixNQUFNLGdCQUFnQixHQUFHLG1FQUF1QixDQUFDLFdBQVcsQ0FDMUQsNkJBQTZCLENBQzlCLENBQUM7UUFFRixNQUFNLGtDQUFrQyxHQUN0QyxDQUFDLE1BQU0sZ0JBQWdCLENBQUMsR0FBRyxDQUFVLDBDQUEyQixDQUFDLENBQUM7WUFDbEUsS0FBSyxDQUFDO1FBRVIsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QjtZQUNyQyxrQ0FBa0MsRUFDbEM7WUFDQSxPQUFPLElBQUksaURBQW9CLEVBQUUsQ0FBQztTQUNuQztRQUNELE9BQU8sSUFBSSwrQ0FBdUIsQ0FBQyxjQUFjLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbkUsQ0FBQyxDQUFDO0NBQ0g7QUF4QkQsMERBd0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZmlnQ29udHJvbGxlckZhY3RvcnkgfSBmcm9tICcuLi9jb25maWcvbG9jYWxfY29uZmlndXJhdGlvbl9jb250cm9sbGVyX2ZhY3RvcnkuanMnO1xuaW1wb3J0IHsgTm9PcFVzYWdlRGF0YUVtaXR0ZXIgfSBmcm9tICcuL25vb3BfdXNhZ2VfZGF0YV9lbWl0dGVyLmpzJztcbmltcG9ydCB7IERlZmF1bHRVc2FnZURhdGFFbWl0dGVyIH0gZnJvbSAnLi91c2FnZV9kYXRhX2VtaXR0ZXIuanMnO1xuaW1wb3J0IHsgVVNBR0VfREFUQV9UUkFDS0lOR19FTkFCTEVEIH0gZnJvbSAnLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgQW1wbGlmeUVycm9yIH0gZnJvbSAnLi4vaW5kZXguanMnO1xuaW1wb3J0IHsgRGVwZW5kZW5jeSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9wbHVnaW4tdHlwZXMnO1xuXG5leHBvcnQgdHlwZSBVc2FnZURhdGFFbWl0dGVyID0ge1xuICBlbWl0U3VjY2VzczogKFxuICAgIG1ldHJpY3M/OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+LFxuICAgIGRpbWVuc2lvbnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG4gICkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgZW1pdEZhaWx1cmU6IChcbiAgICBlcnJvcjogQW1wbGlmeUVycm9yLFxuICAgIGRpbWVuc2lvbnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG4gICkgPT4gUHJvbWlzZTx2b2lkPjtcbn07XG5cbi8qKlxuICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvblxuICovXG5leHBvcnQgY2xhc3MgVXNhZ2VEYXRhRW1pdHRlckZhY3Rvcnkge1xuICAvKipcbiAgICogQ3JlYXRlcyBVc2FnZURhdGFFbWl0dGVyIGZvciBhIGdpdmVuIGxpYnJhcnkgdmVyc2lvbiwgdXNhZ2UgZGF0YSB0cmFja2luZyBwcmVmZXJlbmNlc1xuICAgKi9cbiAgZ2V0SW5zdGFuY2UgPSBhc3luYyAoXG4gICAgbGlicmFyeVZlcnNpb246IHN0cmluZyxcbiAgICBkZXBlbmRlbmNpZXM/OiBBcnJheTxEZXBlbmRlbmN5PlxuICApOiBQcm9taXNlPFVzYWdlRGF0YUVtaXR0ZXI+ID0+IHtcbiAgICBjb25zdCBjb25maWdDb250cm9sbGVyID0gY29uZmlnQ29udHJvbGxlckZhY3RvcnkuZ2V0SW5zdGFuY2UoXG4gICAgICAndXNhZ2VfZGF0YV9wcmVmZXJlbmNlcy5qc29uJ1xuICAgICk7XG5cbiAgICBjb25zdCB1c2FnZURhdGFUcmFja2luZ0Rpc2FibGVkTG9jYWxGaWxlID1cbiAgICAgIChhd2FpdCBjb25maWdDb250cm9sbGVyLmdldDxib29sZWFuPihVU0FHRV9EQVRBX1RSQUNLSU5HX0VOQUJMRUQpKSA9PT1cbiAgICAgIGZhbHNlO1xuXG4gICAgaWYgKFxuICAgICAgcHJvY2Vzcy5lbnYuQU1QTElGWV9ESVNBQkxFX1RFTEVNRVRSWSB8fFxuICAgICAgdXNhZ2VEYXRhVHJhY2tpbmdEaXNhYmxlZExvY2FsRmlsZVxuICAgICkge1xuICAgICAgcmV0dXJuIG5ldyBOb09wVXNhZ2VEYXRhRW1pdHRlcigpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERlZmF1bHRVc2FnZURhdGFFbWl0dGVyKGxpYnJhcnlWZXJzaW9uLCBkZXBlbmRlbmNpZXMpO1xuICB9O1xufVxuIl19