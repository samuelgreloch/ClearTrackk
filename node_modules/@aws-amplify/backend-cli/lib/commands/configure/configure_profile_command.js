import { AmplifyPrompter, printer } from '@aws-amplify/cli-core';
import { DEFAULT_PROFILE } from '@smithy/shared-ini-file-loader';
import { EOL } from 'os';
import { Open } from '../open/open.js';
const configureAccountUrl = 'https://docs.amplify.aws/gen2/start/account-setup/';
const profileSetupInstruction = `Follow the instructions at ${configureAccountUrl}${EOL}to configure Amplify IAM user and credentials.${EOL}`;
/**
 * Command to configure AWS Amplify profile.
 */
export class ConfigureProfileCommand {
    profileController;
    /**
     * @inheritDoc
     */
    command;
    /**
     * @inheritDoc
     */
    describe;
    /**
     * Configure profile command.
     */
    constructor(profileController) {
        this.profileController = profileController;
        this.command = 'profile';
        this.describe = 'Configure an AWS Amplify profile';
    }
    /**
     * @inheritDoc
     */
    handler = async (args) => {
        const profileName = args.name;
        const profileExists = await this.profileController.profileExists(profileName);
        if (profileExists) {
            printer.print(`Profile '${profileName}' already exists!${EOL}${profileSetupInstruction}`);
            return;
        }
        const hasIAMUser = await AmplifyPrompter.yesOrNo({
            message: 'Do you already have IAM User credentials?',
        });
        if (!hasIAMUser) {
            printer.print(profileSetupInstruction);
            await Open.open(configureAccountUrl, { wait: false });
            await AmplifyPrompter.input({
                message: `Hit [enter] when complete`,
            });
        }
        const accessKeyId = await AmplifyPrompter.secretValue('Enter Access Key ID:');
        const secretAccessKey = await AmplifyPrompter.secretValue('Enter Secret Access Key:');
        const region = await AmplifyPrompter.input({
            message: `Enter the AWS region to use with the '${profileName}' profile (eg us-east-1, us-west-2, etc):`,
            required: true,
        });
        await this.profileController.createOrAppendAWSFiles({
            profile: profileName,
            region,
            accessKeyId,
            secretAccessKey,
        });
        printer.print(`Created profile ${profileName} successfully!`);
    };
    /**
     * @inheritDoc
     */
    builder = (yargs) => {
        return yargs.option('name', {
            describe: 'An AWS profile name',
            type: 'string',
            array: false,
            default: DEFAULT_PROFILE,
        });
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJlX3Byb2ZpbGVfY29tbWFuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tYW5kcy9jb25maWd1cmUvY29uZmlndXJlX3Byb2ZpbGVfY29tbWFuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNqRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ3pCLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUl2QyxNQUFNLG1CQUFtQixHQUN2QixvREFBb0QsQ0FBQztBQUV2RCxNQUFNLHVCQUF1QixHQUFHLDhCQUE4QixtQkFBbUIsR0FBRyxHQUFHLGlEQUFpRCxHQUFHLEVBQUUsQ0FBQztBQUU5STs7R0FFRztBQUNILE1BQU0sT0FBTyx1QkFBdUI7SUFnQkw7SUFiN0I7O09BRUc7SUFDTSxPQUFPLENBQVM7SUFFekI7O09BRUc7SUFDTSxRQUFRLENBQVM7SUFFMUI7O09BRUc7SUFDSCxZQUE2QixpQkFBb0M7UUFBcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUMvRCxJQUFJLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQztRQUN6QixJQUFJLENBQUMsUUFBUSxHQUFHLGtDQUFrQyxDQUFDO0lBQ3JELENBQUM7SUFFRDs7T0FFRztJQUNILE9BQU8sR0FBRyxLQUFLLEVBQ2IsSUFBd0QsRUFDekMsRUFBRTtRQUNqQixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzlCLE1BQU0sYUFBYSxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FDOUQsV0FBVyxDQUNaLENBQUM7UUFDRixJQUFJLGFBQWEsRUFBRTtZQUNqQixPQUFPLENBQUMsS0FBSyxDQUNYLFlBQVksV0FBVyxvQkFBb0IsR0FBRyxHQUFHLHVCQUF1QixFQUFFLENBQzNFLENBQUM7WUFDRixPQUFPO1NBQ1I7UUFDRCxNQUFNLFVBQVUsR0FBRyxNQUFNLGVBQWUsQ0FBQyxPQUFPLENBQUM7WUFDL0MsT0FBTyxFQUFFLDJDQUEyQztTQUNyRCxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1lBRXZDLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sZUFBZSxDQUFDLEtBQUssQ0FBQztnQkFDMUIsT0FBTyxFQUFFLDJCQUEyQjthQUNyQyxDQUFDLENBQUM7U0FDSjtRQUVELE1BQU0sV0FBVyxHQUFHLE1BQU0sZUFBZSxDQUFDLFdBQVcsQ0FDbkQsc0JBQXNCLENBQ3ZCLENBQUM7UUFDRixNQUFNLGVBQWUsR0FBRyxNQUFNLGVBQWUsQ0FBQyxXQUFXLENBQ3ZELDBCQUEwQixDQUMzQixDQUFDO1FBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxlQUFlLENBQUMsS0FBSyxDQUFDO1lBQ3pDLE9BQU8sRUFBRSx5Q0FBeUMsV0FBVywyQ0FBMkM7WUFDeEcsUUFBUSxFQUFFLElBQUk7U0FDZixDQUFDLENBQUM7UUFFSCxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxzQkFBc0IsQ0FBQztZQUNsRCxPQUFPLEVBQUUsV0FBVztZQUNwQixNQUFNO1lBQ04sV0FBVztZQUNYLGVBQWU7U0FDaEIsQ0FBQyxDQUFDO1FBRUgsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsV0FBVyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQztJQUVGOztPQUVHO0lBQ0gsT0FBTyxHQUFHLENBQUMsS0FBVyxFQUF3QyxFQUFFO1FBQzlELE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7WUFDMUIsUUFBUSxFQUFFLHFCQUFxQjtZQUMvQixJQUFJLEVBQUUsUUFBUTtZQUNkLEtBQUssRUFBRSxLQUFLO1lBQ1osT0FBTyxFQUFFLGVBQWU7U0FDekIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0NBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcmd1bWVudHNDYW1lbENhc2UsIEFyZ3YsIENvbW1hbmRNb2R1bGUgfSBmcm9tICd5YXJncyc7XG5pbXBvcnQgeyBBbXBsaWZ5UHJvbXB0ZXIsIHByaW50ZXIgfSBmcm9tICdAYXdzLWFtcGxpZnkvY2xpLWNvcmUnO1xuaW1wb3J0IHsgREVGQVVMVF9QUk9GSUxFIH0gZnJvbSAnQHNtaXRoeS9zaGFyZWQtaW5pLWZpbGUtbG9hZGVyJztcbmltcG9ydCB7IEVPTCB9IGZyb20gJ29zJztcbmltcG9ydCB7IE9wZW4gfSBmcm9tICcuLi9vcGVuL29wZW4uanMnO1xuaW1wb3J0IHsgQXJndW1lbnRzS2ViYWJDYXNlIH0gZnJvbSAnLi4vLi4va2ViYWJfY2FzZS5qcyc7XG5pbXBvcnQgeyBQcm9maWxlQ29udHJvbGxlciB9IGZyb20gJy4vcHJvZmlsZV9jb250cm9sbGVyLmpzJztcblxuY29uc3QgY29uZmlndXJlQWNjb3VudFVybCA9XG4gICdodHRwczovL2RvY3MuYW1wbGlmeS5hd3MvZ2VuMi9zdGFydC9hY2NvdW50LXNldHVwLyc7XG5cbmNvbnN0IHByb2ZpbGVTZXR1cEluc3RydWN0aW9uID0gYEZvbGxvdyB0aGUgaW5zdHJ1Y3Rpb25zIGF0ICR7Y29uZmlndXJlQWNjb3VudFVybH0ke0VPTH10byBjb25maWd1cmUgQW1wbGlmeSBJQU0gdXNlciBhbmQgY3JlZGVudGlhbHMuJHtFT0x9YDtcblxuLyoqXG4gKiBDb21tYW5kIHRvIGNvbmZpZ3VyZSBBV1MgQW1wbGlmeSBwcm9maWxlLlxuICovXG5leHBvcnQgY2xhc3MgQ29uZmlndXJlUHJvZmlsZUNvbW1hbmRcbiAgaW1wbGVtZW50cyBDb21tYW5kTW9kdWxlPG9iamVjdCwgQ29uZmlndXJlUHJvZmlsZUNvbW1hbmRPcHRpb25zPlxue1xuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGNvbW1hbmQ6IHN0cmluZztcblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICovXG4gIHJlYWRvbmx5IGRlc2NyaWJlOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyZSBwcm9maWxlIGNvbW1hbmQuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByb2ZpbGVDb250cm9sbGVyOiBQcm9maWxlQ29udHJvbGxlcikge1xuICAgIHRoaXMuY29tbWFuZCA9ICdwcm9maWxlJztcbiAgICB0aGlzLmRlc2NyaWJlID0gJ0NvbmZpZ3VyZSBhbiBBV1MgQW1wbGlmeSBwcm9maWxlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW5oZXJpdERvY1xuICAgKi9cbiAgaGFuZGxlciA9IGFzeW5jIChcbiAgICBhcmdzOiBBcmd1bWVudHNDYW1lbENhc2U8Q29uZmlndXJlUHJvZmlsZUNvbW1hbmRPcHRpb25zPlxuICApOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBjb25zdCBwcm9maWxlTmFtZSA9IGFyZ3MubmFtZTtcbiAgICBjb25zdCBwcm9maWxlRXhpc3RzID0gYXdhaXQgdGhpcy5wcm9maWxlQ29udHJvbGxlci5wcm9maWxlRXhpc3RzKFxuICAgICAgcHJvZmlsZU5hbWVcbiAgICApO1xuICAgIGlmIChwcm9maWxlRXhpc3RzKSB7XG4gICAgICBwcmludGVyLnByaW50KFxuICAgICAgICBgUHJvZmlsZSAnJHtwcm9maWxlTmFtZX0nIGFscmVhZHkgZXhpc3RzISR7RU9MfSR7cHJvZmlsZVNldHVwSW5zdHJ1Y3Rpb259YFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgaGFzSUFNVXNlciA9IGF3YWl0IEFtcGxpZnlQcm9tcHRlci55ZXNPck5vKHtcbiAgICAgIG1lc3NhZ2U6ICdEbyB5b3UgYWxyZWFkeSBoYXZlIElBTSBVc2VyIGNyZWRlbnRpYWxzPycsXG4gICAgfSk7XG5cbiAgICBpZiAoIWhhc0lBTVVzZXIpIHtcbiAgICAgIHByaW50ZXIucHJpbnQocHJvZmlsZVNldHVwSW5zdHJ1Y3Rpb24pO1xuXG4gICAgICBhd2FpdCBPcGVuLm9wZW4oY29uZmlndXJlQWNjb3VudFVybCwgeyB3YWl0OiBmYWxzZSB9KTtcbiAgICAgIGF3YWl0IEFtcGxpZnlQcm9tcHRlci5pbnB1dCh7XG4gICAgICAgIG1lc3NhZ2U6IGBIaXQgW2VudGVyXSB3aGVuIGNvbXBsZXRlYCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGFjY2Vzc0tleUlkID0gYXdhaXQgQW1wbGlmeVByb21wdGVyLnNlY3JldFZhbHVlKFxuICAgICAgJ0VudGVyIEFjY2VzcyBLZXkgSUQ6J1xuICAgICk7XG4gICAgY29uc3Qgc2VjcmV0QWNjZXNzS2V5ID0gYXdhaXQgQW1wbGlmeVByb21wdGVyLnNlY3JldFZhbHVlKFxuICAgICAgJ0VudGVyIFNlY3JldCBBY2Nlc3MgS2V5OidcbiAgICApO1xuXG4gICAgY29uc3QgcmVnaW9uID0gYXdhaXQgQW1wbGlmeVByb21wdGVyLmlucHV0KHtcbiAgICAgIG1lc3NhZ2U6IGBFbnRlciB0aGUgQVdTIHJlZ2lvbiB0byB1c2Ugd2l0aCB0aGUgJyR7cHJvZmlsZU5hbWV9JyBwcm9maWxlIChlZyB1cy1lYXN0LTEsIHVzLXdlc3QtMiwgZXRjKTpgLFxuICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgfSk7XG5cbiAgICBhd2FpdCB0aGlzLnByb2ZpbGVDb250cm9sbGVyLmNyZWF0ZU9yQXBwZW5kQVdTRmlsZXMoe1xuICAgICAgcHJvZmlsZTogcHJvZmlsZU5hbWUsXG4gICAgICByZWdpb24sXG4gICAgICBhY2Nlc3NLZXlJZCxcbiAgICAgIHNlY3JldEFjY2Vzc0tleSxcbiAgICB9KTtcblxuICAgIHByaW50ZXIucHJpbnQoYENyZWF0ZWQgcHJvZmlsZSAke3Byb2ZpbGVOYW1lfSBzdWNjZXNzZnVsbHkhYCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBpbmhlcml0RG9jXG4gICAqL1xuICBidWlsZGVyID0gKHlhcmdzOiBBcmd2KTogQXJndjxDb25maWd1cmVQcm9maWxlQ29tbWFuZE9wdGlvbnM+ID0+IHtcbiAgICByZXR1cm4geWFyZ3Mub3B0aW9uKCduYW1lJywge1xuICAgICAgZGVzY3JpYmU6ICdBbiBBV1MgcHJvZmlsZSBuYW1lJyxcbiAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgYXJyYXk6IGZhbHNlLFxuICAgICAgZGVmYXVsdDogREVGQVVMVF9QUk9GSUxFLFxuICAgIH0pO1xuICB9O1xufVxuXG5leHBvcnQgdHlwZSBDb25maWd1cmVQcm9maWxlQ29tbWFuZE9wdGlvbnMgPVxuICBBcmd1bWVudHNLZWJhYkNhc2U8Q29uZmlndXJlUHJvZmlsZUNvbW1hbmRPcHRpb25zQ2FtZWxDYXNlPjtcblxudHlwZSBDb25maWd1cmVQcm9maWxlQ29tbWFuZE9wdGlvbnNDYW1lbENhc2UgPSB7XG4gIG5hbWU6IHN0cmluZztcbn07XG4iXX0=