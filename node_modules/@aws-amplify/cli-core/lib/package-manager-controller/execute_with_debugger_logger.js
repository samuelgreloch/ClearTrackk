import { LogLevel } from '../printer/printer.js';
import { execa as _execa } from 'execa';
import { printer } from '../printer.js';
/**
 * Abstracts the execution of a command and pipes outputs/errors to `Printer.debug`
 */
export const executeWithDebugLogger = (cwd, executable, args, execa = _execa, options) => {
    try {
        const childProcess = execa(executable, args, {
            stdin: 'inherit',
            cwd,
            ...options,
        });
        childProcess?.stdout?.on('data', (data) => printer.log(data, LogLevel.DEBUG));
        childProcess?.stderr?.on('data', (data) => printer.log(data, LogLevel.DEBUG));
        return childProcess;
    }
    catch (err) {
        throw new Error(`\`${executable}${args ? ' ' + args.join(' ') : ''}\` did not exit successfully. Rerun with --debug for more information.`, { cause: err });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhlY3V0ZV93aXRoX2RlYnVnZ2VyX2xvZ2dlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYWNrYWdlLW1hbmFnZXItY29udHJvbGxlci9leGVjdXRlX3dpdGhfZGVidWdnZXJfbG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQWUsS0FBSyxJQUFJLE1BQU0sRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUNyRCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR3hDOztHQUVHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsQ0FDcEMsR0FBVyxFQUNYLFVBQWtCLEVBQ2xCLElBQXlCLEVBQ3pCLEtBQUssR0FBRyxNQUFNLEVBQ2QsT0FBc0IsRUFDRyxFQUFFO0lBQzNCLElBQUk7UUFDRixNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRTtZQUMzQyxLQUFLLEVBQUUsU0FBUztZQUNoQixHQUFHO1lBQ0gsR0FBRyxPQUFPO1NBQ1gsQ0FBQyxDQUFDO1FBRUgsWUFBWSxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBWSxFQUFFLEVBQUUsQ0FDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNsQyxDQUFDO1FBQ0YsWUFBWSxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBWSxFQUFFLEVBQUUsQ0FDaEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNsQyxDQUFDO1FBRUYsT0FBTyxZQUFZLENBQUM7S0FDckI7SUFBQyxPQUFPLEdBQUcsRUFBRTtRQUNaLE1BQU0sSUFBSSxLQUFLLENBQ2IsS0FBSyxVQUFVLEdBQ2IsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDaEMsd0VBQXdFLEVBQ3hFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUNmLENBQUM7S0FDSDtBQUNILENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IExvZ0xldmVsIH0gZnJvbSAnLi4vcHJpbnRlci9wcmludGVyLmpzJztcbmltcG9ydCB7IEV4ZWNhTWV0aG9kLCBleGVjYSBhcyBfZXhlY2EgfSBmcm9tICdleGVjYSc7XG5pbXBvcnQgeyBwcmludGVyIH0gZnJvbSAnLi4vcHJpbnRlci5qcyc7XG5pbXBvcnQgeyBFeGVjYU9wdGlvbnMgfSBmcm9tICdAYXdzLWFtcGxpZnkvcGx1Z2luLXR5cGVzJztcblxuLyoqXG4gKiBBYnN0cmFjdHMgdGhlIGV4ZWN1dGlvbiBvZiBhIGNvbW1hbmQgYW5kIHBpcGVzIG91dHB1dHMvZXJyb3JzIHRvIGBQcmludGVyLmRlYnVnYFxuICovXG5leHBvcnQgY29uc3QgZXhlY3V0ZVdpdGhEZWJ1Z0xvZ2dlciA9IChcbiAgY3dkOiBzdHJpbmcsXG4gIGV4ZWN1dGFibGU6IHN0cmluZyxcbiAgYXJncz86IFJlYWRvbmx5PHN0cmluZ1tdPixcbiAgZXhlY2EgPSBfZXhlY2EsXG4gIG9wdGlvbnM/OiBFeGVjYU9wdGlvbnNcbik6IFJldHVyblR5cGU8RXhlY2FNZXRob2Q+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjaGlsZFByb2Nlc3MgPSBleGVjYShleGVjdXRhYmxlLCBhcmdzLCB7XG4gICAgICBzdGRpbjogJ2luaGVyaXQnLFxuICAgICAgY3dkLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9KTtcblxuICAgIGNoaWxkUHJvY2Vzcz8uc3Rkb3V0Py5vbignZGF0YScsIChkYXRhOiBzdHJpbmcpID0+XG4gICAgICBwcmludGVyLmxvZyhkYXRhLCBMb2dMZXZlbC5ERUJVRylcbiAgICApO1xuICAgIGNoaWxkUHJvY2Vzcz8uc3RkZXJyPy5vbignZGF0YScsIChkYXRhOiBzdHJpbmcpID0+XG4gICAgICBwcmludGVyLmxvZyhkYXRhLCBMb2dMZXZlbC5ERUJVRylcbiAgICApO1xuXG4gICAgcmV0dXJuIGNoaWxkUHJvY2VzcztcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgYFxcYCR7ZXhlY3V0YWJsZX0ke1xuICAgICAgICBhcmdzID8gJyAnICsgYXJncy5qb2luKCcgJykgOiAnJ1xuICAgICAgfVxcYCBkaWQgbm90IGV4aXQgc3VjY2Vzc2Z1bGx5LiBSZXJ1biB3aXRoIC0tZGVidWcgZm9yIG1vcmUgaW5mb3JtYXRpb24uYCxcbiAgICAgIHsgY2F1c2U6IGVyciB9XG4gICAgKTtcbiAgfVxufTtcbiJdfQ==